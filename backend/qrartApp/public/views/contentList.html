<div class="content-manager p-4">
	<!-- Header con ricerca -->
	<div class="flex justify-between items-center mb-6">
		<h1 class="text-2xl font-bold">Gestione Contenuti</h1>
		<div class="search-box">
			<input type="text"
				   ng-model="searchQuery"
				   placeholder="ğŸ” Cerca contenuti..."
				   class="px-4 py-2 border rounded-lg focus:outline-none focus:ring-2">
		</div>
	</div>
	
	<!-- Loading state -->
	<div ng-if="loading" class="text-center py-8">
		<div class="spinner"></div>
		<p>Caricamento contenuti...</p>
	</div>
	
	<!-- Error state -->
	<div ng-if="error" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4">
		<p>{{error}}</p>
	</div>
	
	<!-- Content list -->
	<div ng-show="!loading && !error" class="overflow-x-auto">
		<table class="min-w-full bg-white rounded-lg overflow-hidden">
			<thead class="bg-gray-100">
			<tr>
				<th class="px-4 py-3">Nome Chiamante</th>
				<th class="px-4 py-3">Titolo</th>
				<th class="px-4 py-3">Tipo</th>
				<th class="px-4 py-3">Short Code</th>
				<th class="px-4 py-3 text-right">Azioni</th>
			</tr>
			</thead>
			<tbody>
			
			<!-- Riga contenuto -->
			<tr ng-repeat-start="content in contents | filter:searchQuery" class="border-b hover:bg-gray-50">
				<td class="px-4 py-3">{{content.caller_name}}</td>
				<td class="px-4 py-3">{{content.caller_title}}</td>
				<td class="px-4 py-3">
					<span class="px-2 py-1 rounded-full text-xs"
						  ng-class="{
								'bg-blue-100 text-blue-800': content.content_type === 'audio',
								'bg-green-100 text-green-800': content.content_type === 'video',
								'bg-purple-100 text-purple-800': content.content_type === 'audio_call',
								'bg-yellow-100 text-yellow-800': content.content_type === 'video_call'
						  }">
						{{content.content_type}}
					</span>
				</td>
				<td class="px-4 py-3 font-mono">
					<a ng-href="{{ base_url + '/content/' + content.short_code }}" target="_blank"
					   class="text-blue-500 hover:underline">
						{{content.short_code}}
					</a>
				</td>
				<td class="px-4 py-3 text-right flex items-center justify-end space-x-2">
					<!-- Dettagli -->
					<button ng-click="toggleDetails(content)"
							class="p-2 text-gray-600 hover:text-gray-900"
							title="Dettagli">
						<i class="fas"
						   ng-class="{'fa-chevron-down': expandedContentId != content.id, 'fa-chevron-up': expandedContentId == content.id}"></i>
					</button>
					
					<!-- Modifica -->
					<button ng-click="editContent(content)" class="p-2 text-blue-600 hover:text-blue-900" title="Modifica contenuto">
						<i class="fas fa-edit"></i>
					</button>
					
					<!-- Elimina -->
					<button ng-click="confirmDelete(content)" class="p-2 text-red-600 hover:text-red-900" title="Elimina contenuto">
						<i class="fas fa-trash-alt"></i>
					</button>
				</td>
			</tr>
			
			<!-- Accordion dettagli -->
			<tr ng-repeat-end ng-show="expandedContentId == content.id">
				<td colspan="6">
					<div class="p-4 bg-gray-50 rounded-lg space-y-6">
						
						<!-- ğŸ“Œ FILE GLOBALI (es. callerBackground) -->
						<div ng-if="content.globalFiles.length > 0" class="border-b pb-4">
							<h4 class="text-md font-bold mb-2">ğŸ–¼ï¸ File globali</h4>
							<ul>
								<li ng-repeat="file in content.globalFiles">
									ğŸ“ file_type: <strong>{{ file.file_type }}</strong><br>
									<code>"file_url": "{{ file.file_url }}"</code>
									<button class="ml-2 text-blue-600 text-sm hover:underline" ng-click="replaceFile(file)">
										sostituisci
									</button>
								</li>
							</ul>
						</div>
						
						<!-- ğŸŒ FILE PER LINGUA -->
						<div ng-repeat="(lang, entry) in content.perLanguage" class="pt-4 border-t">
							<h4 class="text-md font-bold mb-2">ğŸŒ {{ lang }}</h4>
							
							<!-- ğŸ§ AUDIO o ğŸ¥ VIDEO -->
							<div ng-if="entry.files.audio || entry.files.video" class="ml-4 mb-2">
								<p>
									ğŸ“ tipo:
									<strong ng-if="entry.files.audio">audio</strong>
									<strong ng-if="!entry.files.audio && entry.files.video">video</strong><br>
									
									<code>
										"file_url":
										<span ng-if="entry.files.audio">"{{ entry.files.audio.file_url }}"</span>
										<span ng-if="!entry.files.audio && entry.files.video">"{{ entry.files.video.file_url }}"</span>
									</code>
									
									<button class="ml-2 text-blue-600 text-sm hover:underline"
											ng-click="replaceFile(entry.files.audio || entry.files.video)">
										sostituisci
									</button>
								</p>
							</div>
							<p ng-if="!entry.files.audio && !entry.files.video" class="ml-4 text-gray-500 italic">
								ğŸ”‡ Nessun file audio/video presente.
							</p>
							
							<!-- ğŸ“„ HTML (se text_only == 1) -->
							<div ng-if="entry.metadata.text_only == '1'" class="ml-4 mt-2">
								<p ng-if="entry.files.html">
									ğŸ“ tipo: <strong>html</strong><br>
									<code>"file_url": "{{ entry.files.html.file_url }}"</code>
									<button class="ml-2 text-blue-600 text-sm hover:underline" ng-click="replaceFile(entry.files.html)">
										sostituisci
									</button>
								</p>
								<p ng-if="!entry.files.html" class="text-gray-500 italic">
									ğŸ“„ Nessun file HTML presente per questa lingua.
								</p>
							</div>
						</div>
					</div>
				</td>
			</tr>
			
			
			</tbody>
		</table>
	</div>
</div>
<!-- ğŸ” Modal sostituzione file -->
<div ng-show="modalVisible" class="fixed inset-0 z-50 flex items-center justify-center bg-black bg-opacity-50">
	<div class="bg-white rounded-lg p-6 w-full max-w-md shadow-lg relative">
		<h2 class="text-lg font-bold mb-4">ğŸ”„ Sostituisci file</h2>
		
		<p><strong>Tipo:</strong> {{ selectedFileToReplace.file_type }}</p>
		<p class="mb-2"><strong>File attuale:</strong> {{ selectedFileToReplace.file_url }}</p>
		
		<input type="file" file-model="newFile" class="w-full border p-2 rounded mb-4">
		
		<div class="flex justify-end space-x-2">
			<button class="px-4 py-2 bg-gray-300 rounded hover:bg-gray-400"
					ng-click="modalVisible = false">Annulla</button>
			
			<button class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700"
					ng-click="confirmReplace()">Conferma</button>
		</div>
	</div>
</div>
